<!DOCTYPE html>
<html>
  <head>
    <title>Git: the bare minimum</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" type="text/css" href="css/style.css"/>
  </head>
  <body>
      <textarea id="source">
class: center, middle

# Git: the bare minimum

[@NicolasRinaudo](https://twitter.com/NicolasRinaudo)


---

class: center, middle

# Vocabulary

---

## Important terms

* `commit`

???

* `commit`: state of the project at a given point in time

--

* `repository`

???

* `repository`: set of commits representing the history of a project, where a project is a set of file

--

* `remote`

???

* `remote`: version of the repository hosted somewhere else (might be a different directory on the same computer)

--

* `staging area`

???

* `staging area`: list of modifications selected for inclusion in a commit

--

* `tag`

???

* `tag`: named commit

--

* `branch`

???

* `branch`: active line of development, the last commit having a permanent alias to HEAD


(See https://git-scm.com/docs/gitglossary)

---

class: center, middle

# Preparing to work

---

## Retrieving a remote repository

* retrieving it for the first time

```console
$ git clone [URI]
```

--

* updating a local version

```console
$ git pull
```

???

`git pull` is dangerous, as it will not only fetch differences (`git fetch`) but also attempt to merge them (`git merge`).

There are various options to make it safer (such as `--ff-only`).

In theory, you should only `pull` from `master`, which you're not allowed to change locally.

---

## Branching out

* step-by-step

```console
$ git branch [BRANCH]
$ git checkout [BRANCH]
```

--

* shortcut

```console
$ git checkout -b [BRANCH]
```

---

class: center, middle

# Exercise: preparing to work

---

## Tasks

* clone repository https://github.com/nrinaudo/workshop-minimum-git.git

--

* branch out to your name, eg `nicolas.rinaudo`

---

## Checking your work

* `git branch`: 2 branches, `master` and yours (flagged as the current one)

* `git diff`: empty

---

class: center, middle

# Basic modifications

---

## Staging modifications

* adding a file (or its modifications):

```console
$ git add [FILE]
```

--

* deleting a file:

```console
$ git rm [FILE]
```

???

Note that you can also delete the file, then stage it with `git add`

--

* renaming a file:

```console
$ git mv [FILE] [NEW_FILE]
```

???

Note that you can also `mv` the file, then stage it with `git add`

---

## Pre-commit health check

* status of the staging area:

```console
$ git status
```

--

* detailled differences:

```console
$ git diff --staged
```

???

Other useful commands:

* `git show`
* `git log -p`

---

## Commiting your work

```console
$ git commit
```

---

## Post-commit health check


* Detailled differences:

```console
$ git diff HEAD~1
```

???

This is the first time the `HEAD~1` syntax is used:

* `HEAD` means _the last commit in the current branch_
* `HEAD~n` means _the nth parent of `HEAD`_

--

* Summarised differences:

```console
$ git diff --summary HEAD~1
$ git diff --stat HEAD~1
```

???

`--summary` lists mode changes (including deletion / creation)

`--stat` lists number of lines changed per file

--

* Commit list:

```console
$ git log
```

???

I'm personally quite partial to `git log --pretty=oneline`

`log` output can be heavily customised. Here's an interesting alias to create:

```
lg =$ log --color --graph --pretty=format:'%C(bold white)%h%Creset -%C(bold green)%d%Creset %s %C(bold green)(%cr)%Creset %C(bold blue)<%an>%Creset' --abbrev-commit --date=relative
```

---

class: center, middle

# Exercise: basic modifications

---

## Tasks

* delete `DELETEME.md`

--

* move `MOVEME.md` to `MOVED.md`

--

* create `README.md`

```plaintext
FOO

BAR

BAZ
```

--

* commit your work

---

## Checking your work

* 3 commits

* 2 files, `README.md` and `MOVED.md`

* staging area diff: empty

---

class: center, middle

# Selective modifications

---

## Patching

* Staging parts of a file:

```console
$ git add -p [FILE]
```

--

* Possible actions on each atomical change (_hunk_):

  * `y`: stage it
--

  * `a`: stage all
--

  * `n`: do not stage it
--

  * `q`: do not stage it, nor any subsequent one
--

  * `s`: split it

---

class: center, middle

# Exercise: selective modifications

---

## Tasks

* edit `README.md` to contain:

```plaintext
foo

bar

baz
```

--

* commit each paragraph in a different commit (you might have to split _hunks_)
  * _hint_: if you make a mistake, `git reset` to unstage everything.

---

## Checking your work

* 6 commits

* Commit 4, 5 and 6 each update a single paragraph of `README.md`

* staging area diff: empty


---

class: center, middle

# Fixing things: before commit

---

## Unstaging

* a file:

```console
$ git reset [FILE]
```

--

* part(s) of a file:

```console
$ git reset -p [FILE]
```

---

class: center, middle

# Exercise: fixing things before a commit

---

## Tasks

* edit `README.md` to replace each paragraph by another

```plaintext
foo2

bar2

baz2
```

--

* stage `README.md`

--

* unstage the second and third paragraph

--

* commit your work

---

## Checking your work

* 7 commits

* last commit's diff: `foo2` in `README.md`

* staging area's diff: `bar2` and `baz2`

---

class: center, middle

# Fixing things: in the last commit

---

## Amending the last commit


```console
$ git commit --amend
```

---

class: center, middle

# Exercise: fixing the last commit

---

## Tasks

* add the remaining modifications in `README.md`

--

* include them in the last commit

--

* update the commit log to reflect the change


---

## Checking your work

* 7 commits

* last commit's diff: the entire `README.md` file

* staging area diff: empty

---

class: center, middle

# Fixing things: older commits (not yet pushed)

---

## Interactive rebasing

```console
$ git rebase -i [REF]
```

Where `[REF]` is a reference to *the parent* of the oldest commit you want to edit.
For example:
* `master`
* `cf69ed7`
* `HEAD~2`

---

## Interactive rebasing

Allows you to:
--

* delete one or more commits
--

* re-order commits
--

* merge ("squash") commits
--

* edit commits
--

* update a commit's message

---

### Safety net

* tag the current state

```console
$ git tag QUICKSAVE
```

???

Or remember the hash of your current commit, if you have a galaxy brain.

--

* do the rebase

--

* if the result is not what you wanted, restore the saved state

```console
$ git reset --hard QUICKSAVE
```

--

* otherwise, delete the tag

```console
$ git tag -d QUICKSAVE
```

???

It's important to delete the tag since very often, tags are used to trigger releases and we don't want to push `QUICKSAVE` by mistake

---

### Aborting

While in the process of rebasing, you can always abort

```console
$ git rebase --abort
```

???

Meaning that you can abort a rebase:
* in the middle of it (`--abort`)
* after you're done, if you realise you messed up (`reset --hard`)

---

class: center, middle

# Merging commits

---

### Merging commits


* rebase interactively

--

* reorder things so that the commits to merge are adjacent

--

* `squash` or `fixup` the "youngest" commit

---

class: center, middle

# Exercise: Merging commits

---

## Tasks

* merge the 3 commits in which you initially edited `README.md`

  * _hint_: this does not include the last commit
  * _hint_: don't hesitate to play with `fixup` and `squash`
  * _hint_: don't hesitate to tag before attempting the rebase

---

## Checking your work

* 5 commits

* last commit diff: append 2 to each paragraph

* before-last commit diff: lower case each paragraph

* staging area diff: empty

---

class: center, middle

# Changing a commit message

---

## Changing a commit message

* rebase interactively

--

* `reword` the desired commit(s)


---

class: center, middle

# Exercise: changing a commit message

---

## Tasks

* update the last 2 commit messages to reflect reality


---

## Checking your work

* Same thing as before, but with more useful commit messages

---

class: center, middle

# Fixing existing commits

---

## Fixing an existing commit

* rebase interactively and `edit` that commit

--

* stage your fixes

--


* `amend` the last commit

--


* run `git rebase --continue`

---

## Splitting an existing commit

* rebase interactively and `edit` that commit

--

* `reset` the desired file to the previous commit's state

--

* stage and commit your various changesets, amending when necessary

--

* run `git rebase --continue`

---

class: center, middle

# Exercise: Fixing existing commits


---

## Tasks

* split the second to last commit (_lowercase_) into 3, one per paragraph
  * _hint:_ you've already seen `git reset [FILE]`, think about what `git reset [REF] [FILE]` could do


---

## Checking your work

* 7 commits

* commits 4, 5, 6 each lower case a single paragraph

* staging area diff: empty


---

class: center, middle

# Dropping a commit

---

## Dropping a commit

* rebase interactively

--

* remove the commit from the list

---

class: center, middle

# Exercise: dropping a commit

---

## Tasks

* drop the last commit


---

## Checking your work

* 6 commits

* `README.md` entirely lower case

* staging area diff: empty

---

class: center, middle

# Sharing your work

---

## Syncing with `origin`

* Make sure your version of `master` is up to date

```console
$ git checkout master
$ git pull
$ git checkout [BRANCH]
```

--

* Incorporate changes

```console
$ git rebase master
```

---

## Publishing your work

* For the first time:

```console
$ git push --set-upstream origin [BRANCH]
```

--

* Once the upstream has been set:

```console
$ git push
```

--

* If you've modified commits rather than just added some:

```console
$ git push -f
```


---

class: center, middle

# Exercise: publishing your work

---

## Tasks

* make sure your branch is in a state you're happy with

--

* push it (might not work, I have to figure this out)

---
class: center, middle
name: questions

# Questions?

[@NicolasRinaudo](https://twitter.com/NicolasRinaudo)


    </textarea>
    <script src="js/remark.js" type="text/javascript">
    </script>
    <script type="text/javascript">
        var slideshow = remark.create({
          highlightStyle: 'github',
          highlightSpans: true,
          highlightLines: true
      });
    </script>
  </body>
</html>
