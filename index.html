<!DOCTYPE html>
<html>
  <head>
    <title>Git: the bare minimum</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" type="text/css" href="css/style.css"/>
  </head>
  <body>
      <textarea id="source">
class: center, middle

# Git: the bare minimum

Nicolas Rinaudo • [`@NicolasRinaudo`](https://twitter.com/NicolasRinaudo) • [Besedo](http://besedo.com)

---

## Overview

This is meant for developers with a basic understanding of git.

The goal is to get hands-practice with what I deem the bare minimum git knowledge:

--

* retrieving and branching off of existing repositories

--

* modifying the content of a repository

--

* exposing modifications in a clean, logical and easily reviewable way

---

## Caveat Emptor

This workshop is meant for a very specific kind of git workflow:

* central repository

* features implemented in branches

* approved modifications merged into a master branch

--

The practice gained here might not be sufficient for all workflows.

--

This workshop is meant to demistify some of the common scenarios, and is not a substitue to actually learning git.

---

class: center, middle

# Vocabulary

---

## Important terms

* `commit`

* `repository`

* `remote`

* `staging area`

* `tag`

* `branch`

???

[Reference](https://git-scm.com/docs/gitglossary)

* `commit`: state of the project at a given point in time

* `repository`: set of commits representing the history of a project, where a project is a set of file

* `remote`: version of the repository hosted somewhere else (might be a different directory on the same computer)

* `staging area`: list of modifications selected for inclusion in a commit

* `tag`: named commit

* `branch`: active line of development, the last commit having a permanent alias to HEAD

---

class: center, middle

# Preparing to work

---

## Retrieving a remote repository

* retrieving it for the first time

```shell
❱ git clone URI
```

--

* updating a local version

```shell
❱ git pull
```

???

`git pull` is dangerous, as it will not only fetch differences (`git fetch`) but also attempt to merge them (`git merge`).

There are various options to make it safer (such as `--ff-only`).

In theory, you should only `pull` from `master`, which you're not allowed to change locally.

---

## Branching out

* step-by-step

```shell
❱ git branch BRANCH
❱ git checkout BRANCH
```

--

* shortcut

```shell
❱ git checkout -b BRANCH
```

---

class: center, middle

# Exercise: preparing to work

---

## Tasks

* clone repository https://github.com/nrinaudo/workshop-minimum-git.git

* branch out to your name, eg `nicolas.rinaudo`

???

```
git clone git@github.com:nrinaudo/workshop-minimum-git.git
cd workshop-minimum-git
git checkout -b foo.bar
```

---

class: center, middle

# Basic modifications

---

## Staging modifications

* adding a file:

```shell
❱ git add FILE
```

--

* deleting a file:

```shell
❱ git rm FILE
```

???

Note that you can also delete the file, then stage it with `git add`

--

* renaming a file:

```shell
❱ git mv FILE NEW_FILE
```

???

Note that you can also `mv` the file, then stage it with `git add`

---

## Checking what you've done

Before commiting your work, it's important to double check it.

* status of the staging area:

```shell
❱ git status
```

--

* detailled differences:

```shell
❱ git diff --staged
```

???

Other useful commands:

* `git show`
* `git log -p`

---

## Commiting your work

Once you're confident that you want to commit your staging area:

```shell
❱ git commit
```

---

## Checking what you've committed


* View detailled differences:

```shell
❱ git diff HEAD~1
```

???

This is the first time the `HEAD~1` syntax is used:

* `HEAD` means _the last commit in the current branch_
* `HEAD~n` means _the nth parent of `HEAD`_

--

* View summarised differences:

```shell
❱ git diff --summary HEAD~1
❱ git diff --stat HEAD~1
```

???

`--summary` lists mode changes (including deletion / creation)

`--stat` lists number of lines changed per file

--

* View the list of commits:

```shell
❱ git log
```

???

I'm personally quite partial to `git log --pretty=oneline`

`log` output can be heavily customised. Here's an interesting alias to create:

```
lg => log --color --graph --pretty=format:'%C(bold white)%h%Creset -%C(bold green)%d%Creset %s %C(bold green)(%cr)%Creset %C(bold blue)<%an>%Creset' --abbrev-commit --date=relative
```

---

class: center, middle

# Exercise: basic modifications

---

## Tasks

* delete `DELETEME.md`

* move `MOVEME.md` to `MOVED.md`

* create a new `README.md`
  * _hint:_ You can use this [lorem ipsum generator](https://loremipsum.io/generator/?n=3&t=p) for content, say, 3 paragraphs.
  * _hint:_ Paragraphs are separated by an explicit empty line. This is important for what follows.

* commit your work

???

```shell
git rm DELETEME.md

git mv MOVEME.md MOVED.md

cat <<EOT >| README.md
Lorem ipsum

Dolor sit amet

Consectetur adipiscing elit
EOT

git add README.md

git commit -m "Clean up markdown files"
```

---

### Expected output (diff with previous)

* Summarised diff:

```shell
❱ git diff --summary HEAD~1
delete mode 100644 DELETEME.md
rename MOVEME.md => MOVED.md (100%)
create mode 100644 README.md
```

---

### Expected output (log)

```shell
❱ git log --pretty=oneline
ba1abdb6e Clean up markdown files
192181b56 Setup the basics for the workshop
87ef53f3f Initialise repository
```

---

class: center, middle

# Selective modifications

---

## Patching

It's possible to stage parts of a file only:

```shell
❱ git add -p FILE
```

--

Git identifies what it thinks are atomical changes (_hunks_) and asks you what to do with each:

* `y`: stage it
* `a`: stage all
* `n`: do not stage it
* `q`: do not stage it, nor any subsequent one
* `s`: split it

---

class: center, middle

# Exercise: selective modifications

---

## Tasks

* edit `README.md` to replace each paragraph by another

* commit each paragraph in a different commit
  * it's possible that you will have to split hunks

???

```shell
cat <<EOT >| README.md
foo

bar

baz
EOT

git add -p README.md

git commit -m "Update first paragraph"

git add -p README.md

git commit -m "Update second paragraph"

git add -p README.md

git commit -m "Update third paragraph"
```

---

### Expected output (log)

```shell
❱ git log --pretty=oneline
3dcbde657 Update third paragraph
eaa9faff8 Update second paragraph
c2f34f358 Update first paragraph
ba1abdb6e Clean up markdown files
192181b56 Setup the basics for the workshop
87ef53f3f Initialise repository
```

---

### Expected output (diff with previous)

```shell
❱ git diff HEAD~3
diff --git a/README.md b/README.md
index b617d62..cf69ed7 100644
--- a/README.md
+++ b/README.md
@@ -1,5 +1,5 @@
-Lorem ipsum
+foo

-Dolor sit amet
+bar

-Consectetur adipiscing elit
+baz
```

---

class: center, middle

# Fixing things: before commit

---

## Unstaging

* a file:

```shell
❱ git reset FILE
```

* part(s) of a file:

```shell
❱ git reset -p FILE
```

---

class: center, middle

# Exercise: fixing things before a commit

---

## Tasks

* edit `README.md` to replace each paragraph by another

* add `README.md`

* unstage the second and third paragraph

* commit your work

???

```shell
cat <<EOT >| README.md
foo2

bar2

baz2
EOT
git add README.md
git reset -p README.md
git commit -m "Update the first paragraph (a second time)"
```

---

### Expected output (status)

```shell
❱ git status
On branch nicolas.rinaudo
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

	modified:   README.md

no changes added to commit (use "git add" and/or "git commit -a")
```
---

### Expected output (log)


```shell
❱ git log --pretty=oneline
2dfbf7564 Update the first paragraph (a second time)
3dcbde657 Update third paragraph
eaa9faff8 Update second paragraph
c2f34f358 Update first paragraph
ba1abdb6e Clean up markdown files
192181b56 Setup the basics for the workshop
87ef53f3f Initialise repository
```

---

### Expected output (diff with staging)

```shell
❱ git diff
diff --git a/README.md b/README.md
index 19fca47..0ec58b6 100644
--- a/README.md
+++ b/README.md
@@ -1,5 +1,5 @@
 foo2

-bar
+bar2

-baz
+baz2
```

---

### Expected output (diff with previous)

```shell
❱ git diff HEAD~1
diff --git a/README.md b/README.md
index cf69ed7..0ec58b6 100644
--- a/README.md
+++ b/README.md
@@ -1,5 +1,5 @@
-foo
+foo2

-bar
+bar2

-baz
+baz2
```

---

class: center, middle

# Fixing things: in the last commit

---

## Amending the last commit

If you need to correct your last commit, you can stage modications and run:

```shell
❱ git commit --amend
```

(Be careful of [typos](https://twitter.com/francesc/status/965710491677945856) here)

--

This also gives you the opportunity to reword your commit message if you need to.

???

If you don't need to, you can use `git commit --amend --no-edit`

---

class: center, middle

# Exercise: fixing the last commit

---

## Tasks

* add the remaining modifications in `README.md`

* shove them in the last commit

* update the commit log to reflect the change

???

```shell
git commit -a --amend -m "Update all paragraphs (a second time)"
```

---

### Expected output (log)

```shell
❱ git log --pretty=oneline
db854c0a6 Update all paragraphs (a second time)
3dcbde657 Update third paragraph
eaa9faff8 Update second paragraph
c2f34f358 Update first paragraph
ba1abdb6e Clean up markdown files
192181b56 Setup the basics for the workshop
87ef53f3f Initialise repository
```

---

### Expected output (diff)

```shell
❱ git diff HEAD~1
diff --git a/README.md b/README.md
index cf69ed7..0ec58b6 100644
--- a/README.md
+++ b/README.md
@@ -1,5 +1,5 @@
-foo
+foo2

-bar
+bar2

-baz
+baz2
```

---

class: center, middle

# Fixing things: older commits (not yet pushed)

---

## Interactive rebasing

You can edit existing commits through:

```shell
❱ git rebase -i REF
```

Where `REF` is a reference to the parent of the oldest commit you want to edit.
For example:
* `master`
* `cf69ed7`
* `HEAD~2`

???

`master` should be the most common used, given our workflow of creating feature branches off `master`

--

This lets you:
* delete one or more commits
* re-order commits
* merge ("squash") commits
* edit commits
* update a commit's message

---

### Safety net

If you don't feel confident, you can "save" your work before rebasing

--

* tag the current state

```shell
❱ git tag QUICKSAVE
```

???

Or remember the hash of your current commit, if you have a galaxy brain.

--

* do the rebase

--

* if the result is not what you wanted, restore the saved state

```shell
❱ git reset --hard QUICKSAVE
```

--

* otherwise, delete the tag

```shell
❱ git tag -d QUICKSAVE
```

???

It's important to delete the tag since very often, tags are used to trigger releases and we don't want to push `QUICKSAVE` by mistake

---

### Aborting

While in the process of rebasing, you can always abort

```shell
❱ git rebase --abort
```

???

Meaning that you can abort a rebase:
* in the middle of it (`--abort`)
* after you're done, if you realise you messed up (`reset --hard`)

---

### Common scenarios ¹

* Merging commits

  * rebase interactively
  * reorder things so that the commits to merge are adjacent
  * `squash` or `fixup` the "youngest" commit

--

* Fixing a git message

  * rebase interactively
  * `reword` the desired commit(s)


---

class: center, middle

# Exercise: common scenarios ¹

---

## Tasks

* merge the 3 commits in which you initially edited `README.md`
  * _hint_: this does not include the last commit
  * _hint_: don't hesitate to play with `fixup` and `squash`
  * _hint_: don't hesitate to tag before attempting the rebase

* update the resulting commit's log message

???

```shell
git rebase -i master
```

* `r` on `c2f34f358`
* `f` on `3dcbde657`
* `f` on `eaa9faff8`
---

### Expected output (log)

```shell
❱ git log --pretty=oneline
9be035c7b Update all paragraphs (a second time)
a3ee93a70 Update all paragraphs (a first time)
ba1abdb6e Clean up markdown files
192181b56 Setup the basics for the workshop
87ef53f3f Initialise repository
```

---

### Expected output (diff)

```shell
❱ git diff HEAD~2 HEAD~1
diff --git a/README.md b/README.md
index b617d62..cf69ed7 100644
--- a/README.md
+++ b/README.md
@@ -1,5 +1,5 @@
-Lorem ipsum
+foo

-Dolor sit amet
+bar

-Consectetur adipiscing elit
+baz
```

---

## Common scenarios ²

* Fix an existing commit

  * rebase interactively and `edit` that commit
  * stage your fixes
  * `amend` the last commit
  * run `git rebase --continue`

--

* Split an existing commit

  * rebase interactively and `edit` that commit
  * `reset` the desired file to the previous commit's state
  * stage and commit your various changesets, amending when necessary
  * run `git rebase --continue`

--

* Drop a commit

  * rebase interactively
  * remove the commit from the list

---

class: center, middle

# Exercise: common scenarios ²

---

## Tasks

* split the second to last commit (the one you just created) into 3, one per paragraph
  * _hint:_ you've already seen `git reset FILE`, think about what `git reset REF FILE` could do

* drop the last commit

???

```shell
git rebase -i master
```

Then:
* edit `a3ee93a`
* drop `9be035c7b`

Then:
```shell
git reset HEAD~1 README.md
git add -p README.md
git commit -m "Update first paragraph" --amend
git add -p README.md
git commit -m "Update second paragraph"
git add -p README.md
git commit -m "Update third paragraph"
git rebase --continue
```
---

### Expected output (log)

```shell
❱ git log --pretty=oneline
646b52b15 Update third paragraph
82263ba8f Update second paragraph
e44dd5024 Update first paragraph
ba1abdb6e Clean up markdown files
192181b56 Setup the basics for the workshop
87ef53f3f Initialise repository
```

---

### Expected output (diff)

```shell
❱ git diff HEAD~3
diff --git a/README.md b/README.md
index b617d62..cf69ed7 100644
--- a/README.md
+++ b/README.md
@@ -1,5 +1,5 @@
-Lorem ipsum
+foo

-Dolor sit amet
+bar

-Consectetur adipiscing elit
+baz
```

---

class: center, middle

# Sharing your work

---

## Syncing with `origin`

* Make sure your version of `master` is up to date

```shell
❱ git checkout master
❱ git pull
❱ git checkout BRANCH
```

???

There should be no conflict here, since you're not allowed to change `master`.

--

* If necessary, incorporate changes

```shell
❱ git rebase master
```

--

You can use the same techniques as interactive rebase to deal with errors

---

## Publishing your work

* For the first time

```shell
❱ git push --set-upstream origin BRANCH
```

--

* Amending a pushed branch

```shell
❱ git push -f
```

Note that `-f` is only necessary if you've modified existing commits rather than added new ones

---

class: center, middle

# Exercise: publishing your work

---

## Tasks

* make sure your branch is in a state you're happy with

* push it (might not work, I have to figure this out)

---

class: center, middle

# Thanks!

    </textarea>
    <script src="js/remark.js" type="text/javascript">
    </script>
    <script type="text/javascript">
        var slideshow = remark.create({
        highlightStyle: 'solarized-dark'
      });
    </script>
  </body>
</html>
